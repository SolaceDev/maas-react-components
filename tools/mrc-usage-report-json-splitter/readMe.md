# MRC Usage Report JSON Splitter

## Purpose

The `mrc-usage-report-json-splitter` is a command-line tool designed to process and restructure the monolithic JSON output generated by the `mrc-usage-report` tool. The primary problem it solves is the difficulty of consuming a single, large JSON file that contains all component usage data across multiple applications and micro-frontends (MFEs).

This tool breaks down the large report into a more granular and organized directory structure, making the data easier to query, analyze, and use for various purposes, such as powering dashboards or other data-driven tools.

## How it Works

The tool operates by reading a single merged JSON report file and then creating a structured set of smaller JSON files and directories. The process is as follows:

1.  **Input:** It takes the path to a large JSON file (e.g., `mrc-usage-report-all.json`) as input.
2.  **Parsing:** It parses the JSON content, focusing on the `componentStats` array which contains detailed usage information for each MaaS React Component.
3.  **Splitting:** The tool creates two primary data structures:
    - **`per-component`:** A directory where each component has its own sub-directory. Inside, usage data is split into individual files like `totalUsages.json`, `usagesByMfe.json`, `commonProps.json`, `files.json`, and `instances.json`. This allows for easy lookup of all data related to a specific component.
    - **`per-application`:** A directory that organizes the data by application and then by MFE. This structure provides a view of component usage within the context of a specific application or MFE, including aggregated statistics.
4.  **Output:** The final output is a directory (e.g., `mrc-usage-report-data/`) containing the structured, split-out JSON files.

## Usage

### CLI Options

The tool can be configured with the following command-line options:

| Option                | Description                              | Default Value                        |
| --------------------- | ---------------------------------------- | ------------------------------------ |
| `-i, --input <path>`  | Input path for the merged JSON report    | `../../merged-mrc-usage-report.json` |
| `-o, --output <path>` | Output directory for the generated files | `output/`                            |

### How to Run

1.  **Build the tool:**

    ```bash
    npm install
    npm run build
    ```

2.  **Run the script:**

    ```bash
    npm start -- -i <path-to-input-json> -o <path-to-output-directory>
    ```

    For example, as seen in the GitHub workflow:

    ```bash
    npm start -- -i ../mrc-usage-report/reports/mrc-usage-report-all.json -o ../../../maas-react-components-repo/mrc-usage-report-data
    ```

## Integration in the MRC Usage Report Workflow

This tool is an integral part of the automated `mrc-usage-report` generation process, as defined in the `.github/workflows/mrc-usage-report-worker.yml` GitHub Actions workflow.

Its role in the workflow is as follows:

1.  **Generate Main Report:** The workflow first runs the main `mrc-usage-report` tool to scan the codebase and generate the `mrc-usage-report-all.json` file.
2.  **Split the Report:** Immediately after the main report is created, the "Split merged JSON" step is executed. This step runs the `mrc-usage-report-json-splitter` tool.
3.  **Commit Data:** The tool takes the monolithic JSON file as input and produces the structured `mrc-usage-report-data` directory. This directory is then committed back to the repository.

By running as part of this workflow, the splitter ensures that the detailed, queryable usage data is always up-to-date with the latest scan of the codebase.
